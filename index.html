<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>注文フォーム - tyuumou</title>
<style>
body{font-family:sans-serif; padding:20px; background:#f3f4f6;}
h1{color:#1f2937;}
section{margin-bottom:16px;}
h3{cursor:pointer; background:#e5e7eb; padding:8px; border-radius:6px;}
.list{display:none; border:1px solid #ddd; border-radius:6px; background:#fff; margin-top:6px;}
table{width:100%; border-collapse:collapse;}
th,td{padding:6px; border-bottom:1px solid #ddd; text-align:left;}
input[type="number"]{width:60px;}
button{padding:8px 14px; border:none; background:#2563eb; color:#fff; border-radius:6px; cursor:pointer;}
button:hover{background:#1e40af;}
.summary{margin-top:16px; font-weight:bold;}
</style>
</head>
<body>

<h1>注文システム</h1>

<form id="orderForm">

<div id="products-container"></div>

<section>
<label><input type="checkbox" id="express"> 速達 (プラス300円)</label>
</section>

<section>
<button type="button" id="calculate">合計金額を確認</button>
<button type="button" id="submitOrder">注文送信</button>
</section>

<p class="summary" id="totalDisplay">合計: ¥0</p>

</form>

<script>
// ---------------- 商品データ ----------------
const categories = {
  "食べ物": [
    {name:"カップラーメン", price:180},
    {name:"おにぎり（鮭）", price:120},
    {name:"ペットボトル水(500ml)", price:100},
    {name:"缶コーヒー", price:130},
    {name:"菓子パン", price:150}
  ],
  "生活用品": [
    {name:"ティッシュ(5箱)", price:300},
    {name:"トイレットペーパー(12ロール)", price:350},
    {name:"食器用洗剤", price:200},
    {name:"洗濯洗剤", price:400}
  ],
  "衛生用品": [
    {name:"マスク(50枚)", price:500},
    {name:"アルコール消毒液", price:600},
    {name:"ハンドソープ", price:250}
  ],
  "文具": [
    {name:"ボールペン", price:100},
    {name:"ノート", price:120},
    {name:"付箋", price:150},
    {name:"クリアファイル(10枚)", price:200}
  ],
  "家電": [
    {name:"ドライヤー", price:3000},
    {name:"電気ケトル", price:2500},
    {name:"炊飯器", price:8000}
  ]
};

// ---------------- UI生成 ----------------
const container = document.getElementById('products-container');

for(let cat in categories){
  const section = document.createElement('section');
  const title = document.createElement('h3');
  title.textContent = cat;

  const list = document.createElement('div');
  list.className = 'list';

  const table = document.createElement('table');
  table.innerHTML = `
    <tr><th>商品名</th><th>価格</th><th>数量</th></tr>
  `;

  categories[cat].forEach(item=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.name}</td>
      <td>¥${item.price}</td>
      <td><input type="number" min="0" value="0" data-price="${item.price}" data-name="${item.name}"></td>
    `;
    table.appendChild(tr);
  });

  list.appendChild(table);
  title.addEventListener('click', ()=> list.style.display = list.style.display==='none'?'block':'none');

  section.appendChild(title);
  section.appendChild(list);
  container.appendChild(section);
}

// ---------------- 料金計算 ----------------
function calculateTotal(){
  const inputs = document.querySelectorAll('#products-container input[type="number"]');
  let total = 0;
  inputs.forEach(input=>{
    const qty = parseInt(input.value) || 0;
    const price = parseInt(input.dataset.price);
    total += qty * price;
  });

  if(document.getElementById('express').checked){
    total += 300;
  }
  document.getElementById('totalDisplay').textContent = `合計: ¥${total}`;
  return total;
}

document.getElementById('calculate').addEventListener('click', calculateTotal);

// ---------------- 注文送信 ----------------
document.getElementById('submitOrder').addEventListener('click', ()=>{
  const inputs = document.querySelectorAll('#products-container input[type="number"]');
  const orderItems = [];
  inputs.forEach(input=>{
    const qty = parseInt(input.value)||0;
    if(qty>0){
      orderItems.push({name: input.dataset.name, quantity: qty, price: parseInt(input.dataset.price)});
    }
  });

  if(orderItems.length===0){
    alert('商品を1つ以上選択してください');
    return;
  }

  const total = calculateTotal();
  const express = document.getElementById('express').checked;

  sessionStorage.setItem('orderData', JSON.stringify({orderItems, total, express}));
  window.location.href = 'sousinn.html';
});
</script>

</body>
</html>
